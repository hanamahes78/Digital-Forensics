# Network Analysis of Agent Tesla Malware

## Introduction
A company reported malware activity associated with Agent Tesla, originating from another malware family known as OriginLogger. The infected system was a Windows host. In addition to normal Windows traffic, the captured PCAP file contained unencrypted SMTP communications generated by the malware. These SMTP sessions included various login credentials exfiltrated from the infected host.

Although the credentials were not genuine (as the host was preloaded with fabricated data prior to executing the malware), the captured traffic provides valuable insights into the type of information typically stolen by Agent Tesla variants, such as OriginLogger.

## Tools Used
In this case study, `Wireshark` was used to analyze the network traffic generated by the malware. Wireshark enables real-time packet capture and in-depth inspection of network data, offering detailed insights into communication patterns.

The tool provides protocol-level analysis, including SMTP traffic, which facilitates the identification of stolen information such as transmitted login credentials.
Wireshark proves to be an essential tool for detecting and analyzing suspicious activity within network communications.

## Digital Evidence Description
The digital evidence analyzed consisted of a `PCAP file` containing captured network traffic generated during the malware’s operation.

This traffic includes SMTP communication associated with the transmission of stolen login credentials. Several packets within the capture file exhibited patterns indicative of malicious or suspicious activity.

## Forensic Process
1. **Opening the PCAP File in Wireshark**<br>
The provided network capture file was opened using Wireshark to inspect packet contents and communication flow.
<img width="800" alt="PCAPFile" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-1.png"><br>

2. **Applying SMTP Filters**<br>
SMTP protocol filters were applied to isolate and examine potentially suspicious email traffic generated by the malware.
<img width="800" alt="SMTPFilters" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-2.png"><br>

3. **Following the TCP Stream**<br>
`Follow TCP Stream` was used to reconstruct communication sessions, allowing for a detailed analysis of transmitted data and identification of stolen credentials.<br>
<img width="800" alt="FollowTCP-1" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-3.png"><br>
<img width="600" alt="FollowTCP-2" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-4.png"><br>

## Findings
1. **When did the suspicious traffic begin?**<br>
<img width="800" alt="Findings-1" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-5.png"><br>
The suspicious network activity began on `Thursday, January 5, 2023, at 22:51:30`.

2. **What is the victim’s IP address?**<br>
<img width="400" alt="Findings-2" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-6.png"><br>
The victim’s local IP address was `192.168.1.27`.

3. **What is the victim’s MAC address?**<br>
<img width="800" alt="Findings-3" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-7.png"><br>
By analyzing Ethernet frame data within the PCAP file using appropriate filters, the victim’s MAC address was identified as `bc:ea:fa:22:74:fb`.

4. **What is the victim’s Windows host name?**<br>
<img width="500" alt="Findings-4" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-8.png"><br>
The Windows host name of the infected machine was `DESKTOP-WIN11PC`.

5. **What is the victim’s Windows user account name?**<br>
<img width="600" alt="Findings-5" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-9.png"><br>
The Windows user account name associated with the host was `windows11user`.

6. **How much RAM did the victim host possess?**<br>
<img width="600" alt="Findings-6" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-10.png"><br>
The victim’s system contained `32,165.83 MB` of RAM.

7. **What type of CPU was used by the victim host?**<br>
<img width="600" alt="Findings-7" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-11.png"><br>
The host was equipped with an `Intel(R) Core(TM) i5-13600K CPU @ 5.10GHz`.

8. **What was the public IP address of the victim host?**<br>
<img width="600" alt="Findings-8" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-12.png"><br>
The public IP address of the infected host was `173.66.46.112`.

9. **What types of login data were stolen by the malware?**<br>
<img width="600" alt="Findings-9" src="https://github.com/hanamahes78/Digital-Forensics/blob/main/img/R3-13.png"><br>
The malware exfiltrated login credentials from multiple applications and online services, including:
   - Thunderbird<br>
     Email credentials associated with the server `imap://mail.windows11users.com`.
   - Microsoft Edge (Chromium)<br>
     Credentials for several web-based services, including `webmail for webmail.windows11users.com` and `URL for Coca-Cola, LinkedIn, Amazon, Target, and New York Times`.

## Conclusion

The network forensic analysis using Wireshark successfully revealed SMTP-based data exfiltration behavior associated with Agent Tesla/OriginLogger malware. Despite the use of fabricated credentials, the captured network traffic provided a clear representation of how this malware variant collects and transmits stolen data from infected Windows systems. Such findings demonstrate the critical role of network traffic analysis in identifying malicious behavior, understanding data exfiltration methods, and improving incident response strategies in real-world cybersecurity investigations.
